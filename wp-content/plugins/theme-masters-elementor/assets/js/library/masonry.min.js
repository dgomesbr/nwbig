!function(e){"use strict";e.fn.tmeMasonry=function(t){var n,r,a,o,i,c,l,s=e(this);n=window,r=window.document,o=[],i=[],c=[],l=function(e,t,n){e.dataset?e.dataset[t]=n:e.setAttribute("data-"+t,n)},(a={}).obtainGridSettings=function(e){var t=n.getComputedStyle(e,":before").getPropertyValue("content").slice(1,-1),r=t.match(/^\s*(\d+)(?:\s?\.(.+))?\s*$/),a=1,o=[];return r?(a=r[1],o=(o=r[2])?o.split("."):["column"]):(r=t.match(/^\s*\.(.+)\s+(\d+)\s*$/))&&(o=r[1],(a=r[2])&&(a=a.split("."))),{numberOfColumns:a,columnClasses:o}},a.addColumns=function(e,t){for(var n,o=a.obtainGridSettings(e),i=o.numberOfColumns,c=o.columnClasses,s=new Array(+i),u=r.createDocumentFragment(),d=i;0!=d--;)n="[data-columns] > *:nth-child("+i+"n-"+d+")",s.push(t.querySelectorAll(n));s.forEach(function(e){var t=r.createElement("div"),n=r.createDocumentFragment();t.className=c.join(" "),Array.prototype.forEach.call(e,function(e){n.appendChild(e)}),t.appendChild(n),u.appendChild(t)}),e.appendChild(u),l(e,"columns",i)},a.removeColumns=function(e){var t=r.createRange();t.selectNodeContents(e);var a=Array.prototype.filter.call(t.extractContents().childNodes,function(e){return e instanceof n.HTMLElement}),o=a.length,i=a[0].childNodes.length,c=new Array(i*o);Array.prototype.forEach.call(a,function(e,t){Array.prototype.forEach.call(e.children,function(e,n){c[n*o+t]=e})});var s=r.createElement("div");return l(s,"columns",0),c.filter(function(e){return!!e}).forEach(function(e){s.appendChild(e)}),s},a.recreateColumns=function(e){n.requestAnimationFrame(function(){a.addColumns(e,a.removeColumns(e));var t=new CustomEvent("columnsChange");e.dispatchEvent(t)})},a.mediaQueryChange=function(e){e.matches&&Array.prototype.forEach.call(o,a.recreateColumns)},a.getCSSRules=function(e){var t;try{t=e.sheet.cssRules||e.sheet.rules}catch(e){return[]}return t||[]},a.getStylesheets=function(){var e=Array.prototype.slice.call(r.querySelectorAll("style"));return e.forEach(function(t,n){"text/css"!==t.type&&""!==t.type&&e.splice(n,1)}),Array.prototype.concat.call(e,Array.prototype.slice.call(r.querySelectorAll("link[rel='stylesheet']")))},a.mediaRuleHasColumnsSelector=function(e){var t,n;try{t=e.length}catch(e){t=0}for(;t--;)if((n=e[t]).selectorText&&n.selectorText.match(/\[data-columns\](.*)::?before$/))return!0;return!1},a.scanMediaQueries=function(){var e=[];if(n.matchMedia){a.getStylesheets().forEach(function(t){Array.prototype.forEach.call(a.getCSSRules(t),function(t){try{t.media&&t.cssRules&&a.mediaRuleHasColumnsSelector(t.cssRules)&&e.push(t)}catch(t){}})});var t=i.filter(function(t){return-1===e.indexOf(t)});c.filter(function(e){return-1!==t.indexOf(e.rule)}).forEach(function(e){e.mql.removeListener(a.mediaQueryChange)}),c=c.filter(function(e){return-1===t.indexOf(e.rule)}),e.filter(function(e){return-1==i.indexOf(e)}).forEach(function(e){var t=n.matchMedia(e.media.mediaText);t.addListener(a.mediaQueryChange),c.push({rule:e,mql:t})}),i.length=0,i=e}},a.rescanMediaQueries=function(){a.scanMediaQueries(),Array.prototype.forEach.call(o,a.recreateColumns)},a.nextElementColumnIndex=function(e,t){var n,r,a=e.children,o=a.length,i=0,c=0;for(r=0;r<o;r++)n=a[r].children.length+(t[r].children||t[r].childNodes).length,0===i&&(i=n),n<i&&(c=r,i=n);return c},a.createFragmentsList=function(e){for(var t=new Array(e),n=0;n!==e;)t[n]=r.createDocumentFragment(),n++;return t},a.appendElements=function(e,t){var n=e.children,r=n.length,o=a.createFragmentsList(r);Array.prototype.forEach.call(t,function(t){var n=a.nextElementColumnIndex(e,o);o[n].appendChild(t)}),Array.prototype.forEach.call(n,function(e,t){e.appendChild(o[t])})},a.prependElements=function(e,t){var n=e.children,o=n.length,i=a.createFragmentsList(o),c=o-1;t.forEach(function(e){var t=i[c];t.insertBefore(e,t.firstChild),0===c?c=o-1:c--}),Array.prototype.forEach.call(n,function(e,t){e.insertBefore(i[t],e.firstChild)});for(var l=r.createDocumentFragment(),s=t.length%o;0!=s--;)l.appendChild(e.lastChild);e.insertBefore(l,e.firstChild)},a.registerGrid=function(e){if("none"!==n.getComputedStyle(e).display){var t=r.createRange();t.selectNodeContents(e);var i=r.createElement("div");i.appendChild(t.extractContents()),l(i,"columns",0),a.addColumns(e,i),o.push(e)}},a.init=function(){var e=r.createElement("style");e.innerHTML="[data-columns]::before{display:block;visibility:hidden;position:absolute;font-size:1px;}",r.head.appendChild(e);var t=s.find("[data-columns]");Array.prototype.forEach.call(t,a.registerGrid),a.scanMediaQueries(),s.css("opacity","1")},a.init(),a.appendElements,a.prependElements,a.registerGrid,a.recreateColumns,a.rescanMediaQueries,a.init,a.appendElements,a.prependElements,a.registerGrid,a.recreateColumns,a.rescanMediaQueries}}(jQuery);